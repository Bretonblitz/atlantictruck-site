<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>News | Atlantic Truck & Equipment Repair â€“ Edwardsville (Cape Breton)</title>
  <meta name="description" content="Latest trucking and Atlantic Canada headlines curated for our customers.">
  <meta property="og:title" content="News | Atlantic Truck & Equipment Repair â€“ Edwardsville (Cape Breton)">
  <meta property="og:description" content="Latest trucking and Atlantic Canada headlines curated for our customers.">
  <meta property="og:image" content="https://static.wixstatic.com/media/ba2cd3_94b254821d774fbe9be7b8f2b0951e00~mv2.jpg/v1/fill/w_980,h_653,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/ba2cd3_94b254821d774fbe9be7b8f2b0951e00~mv2.jpg">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_CA">
  <meta name="theme-color" content="#B9111B">
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="apple-touch-icon" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="stylesheet" href="/assets/css/style.css">
  <style>
    .news-intro { margin-top: 6px; }
    .inline-note { margin:10px 0 20px; }
    .inline-note a { display:inline-block; padding:6px 10px; border-radius:999px; background:#f5f5f5; text-decoration:none; }
    .inline-note a:hover { text-decoration:underline; }
    .news-grid { display:grid; gap:16px; grid-template-columns: repeat(3,minmax(0,1fr)); }
    @media (max-width: 980px){ .news-grid{grid-template-columns: repeat(2,minmax(0,1fr));} }
    @media (max-width: 640px){ .news-grid{grid-template-columns: 1fr;} }
    .news-card { background:#fff; border-radius:10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); overflow:hidden; display:flex; flex-direction:column; }
    .news-thumb { width:100%; aspect-ratio: 16/9; object-fit:cover; display:block; background:#f3f3f3; }
    .news-body { padding:14px; display:flex; flex-direction:column; gap:8px; }
    .news-meta { font-size:12px; color:#666; display:flex; gap:8px; flex-wrap:wrap; }
    .news-title { font-size:18px; line-height:1.25; }
    .news-title a { text-decoration:none; color:#111; }
    .news-title a:hover { text-decoration:underline; }
    .news-actions { display:flex; justify-content:space-between; align-items:center; margin-top:2px; }
    .chip { background:#f5f5f5; color:#333; border-radius:999px; padding:3px 8px; font-size:12px; }
    .btn-more { display:inline-block; margin-top:18px; }
    .muted-center { color:#666; text-align:center; }
  </style>
</head>
<body>
<div class="emergency-bar">
  <div class="container row spread center">
    <strong>24/7 Emergency Recovery &amp; Towing</strong>
    <div class="row wrap">
      <a class="link-invert" href="tel:9025651730">After Hours: 902-565-1730</a>
      <span class="sm-hide">|</span>
      <a class="link-invert" href="tel:9025657211">902-565-7211</a>
      <a class="btn-light sm-hide" href="/requests.html#service">Requests</a>
    </div>
  </div>
</div>

<header class="site-header">
  <div class="container row spread center">
    <a class="brand row center" href="/index.html">
      <img class="logo" alt="Atlantic Truck & Equipment Repair logo" src="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
      <div>
        <div class="brand-title">Atlantic Truck &amp; Equipment Repair</div>
        <div class="brand-tag">Largest heavy equipment tow trucks east of Halifax</div>
      </div>
    </a>
    <nav class="main-nav">
      <button class="nav-toggle" aria-label="Toggle menu" onclick="document.getElementById('navList').classList.toggle('open')">â˜°</button>
      <ul class="nav-list" id="navList">
        <li><a href="/index.html">Home</a></li>
        <li class="has-sub"><a href="/services/index.html">Services</a>
          <ul class="sub">
            <li><a href="/services/emergency-towing.html">Emergency Towing</a></li>
            <li><a href="/services/towing.html">Towing</a></li>
            <li><a href="/services/repair.html">Repair</a></li>
            <li><a href="/services/inspection.html">Inspection</a></li>
            <li><a href="/services/authorized-parts.html">Authorized Parts</a></li>
            <li><a href="/services/welding.html">Welding</a></li>
          </ul>
        </li>
        <li><a href="/gallery.html">Gallery</a></li>
        <li><a class="active" href="/news.html">News</a></li>
        <li><a href="/service-area.html">Service Area</a></li>
        <li><a href="/requests.html">Requests</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
    <div class="header-cta sm-hide">
      <a id="smartCta" class="btn" href="tel:9025394574" aria-label="Call 24/7 Dispatch">Call 24/7 Dispatch</a>
    </div>
  </div>
</header>

<section class="section">
  <div class="container">
    <h1>News</h1>
    <p class="muted news-intro">Fresh trucking headlines and Atlantic Canada updates. We pull from trusted industry and local sources.</p>
    <div class="inline-note">
      <a href="/traffic.html">Looking for road closures &amp; traffic advisories? See the Traffic page â†’</a>
    </div>

    <div id="newsGrid" class="news-grid" aria-live="polite"></div>
    <div id="newsStatus" class="muted-center" style="margin-top:12px"></div>
    <div style="text-align:center">
      <button id="loadMoreBtn" class="btn btn-more" style="display:none">Load more</button>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="container grid-4">
    <div>
      <div class="footer-title">Atlantic Truck &amp; Equipment Repair Ltd.</div>
      <p class="muted">Trusted for towing, repairs, inspections &amp; welding across Cape Breton and most of Nova Scotia.</p>
      <div class="row wrap" style="gap:12px;margin-top:10px">
        <img src="/assets/img/freightliner.png" alt="Freightliner logo" style="height:26px">
        <img src="/assets/img/western-star.png" alt="Western Star logo" style="height:26px">
      </div>
      <div style="margin-top:10px"><a href="https://www.facebook.com/profile.php?id=61579126693357" target="_blank" rel="noopener">ðŸ“˜ Follow us on Facebook</a></div>
    </div>
    <div>
      <div class="footer-title">Services</div>
      <ul class="plain">
        <li><a href="/services/emergency-towing.html">Emergency Towing</a></li>
        <li><a href="/services/towing.html">Towing</a></li>
        <li><a href="/services/repair.html">Repairs</a></li>
        <li><a href="/services/inspection.html">Inspections</a></li>
        <li><a href="/services/authorized-parts.html">Authorized Parts</a></li>
        <li><a href="/services/welding.html">Welding</a></li>
      </ul>
    </div>
    <div>
      <div class="footer-title">Contact</div>
      <ul class="plain">
        <li>Main: <a href="tel:9025394574">902-539-4574</a></li>
        <li>Service: <a href="mailto:service@atlantictruck.ca">service@atlantictruck.ca</a></li>
        <li>Parts: <a href="mailto:parts@atlantictruck.ca">parts@atlantictruck.ca</a></li>
        <li>Office: <a href="mailto:office@atlantictruck.ca">office@atlantictruck.ca</a></li>
        <li>After Hours: <a href="tel:9025651730">902-565-1730</a> / <a href="tel:9025657211">902-565-7211</a></li>
        <li>Hours: Monâ€“Fri 8:00 AM â€“ 4:30 PM</li>
      </ul>
    </div>
    <div>
      <div class="footer-title">Find Us</div>
      <address class="muted small">417 Gulf Crescent, Edwardsville, NS B2A 4T9</address>
      <a class="btn-light" target="_blank" href="https://www.google.com/maps/place/417+Gulf+Crescent,+Edwardsville,+NS+B2A+4T9/@46.139715,-60.2621357,9339m/data=!3m1!1e3!4m6!3m5!1s0x4b67facb8ef152a3:0x696f8a0bdb36d767!8m2!3d46.1517485!4d-60.2245496!16s%2Fg%2F11snpzymmc?entry=ttu&g_ep=EgoyMDI1MDgxMy4wIKXMDSoASAFQAw%3D%3D">Directions</a>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="container row spread small">
      <span>Â© 2025 Atlantic Truck &amp; Equipment Repair Ltd.</span>
      <span>Edwardsville, Nova Scotia</span>
    </div>
  </div>
</footer>

<div class="action-bar md-hide">
  <a href="tel:9025394574">Call</a>
  <a target="_blank" href="https://maps.google.com/?q=417%20Gulf%20Crescent,%20Edwardsville,%20NS%20B2A%204T9">Directions</a>
  <a href="/requests.html#service">Book Service</a>
</div>

<!-- Page JS -->
<script>
(function(){
  const newsGrid    = document.getElementById('newsGrid');
  const statusEl    = document.getElementById('newsStatus');
  const loadMoreBtn = document.getElementById('loadMoreBtn');

  const PLACEHOLDER =
    'https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png';

  // Client fallback (used ONLY if server returns nothing); NO traffic feeds here
  const FEEDS = [
    { name: 'Halifax â€“ All News',     url: 'https://www.halifax.ca/news/rss-feed' },
    { name: 'NS Gov â€“ All Releases',  url: 'https://novascotia.ca/news/rss/rss.asp' },
    { name: 'CBC Nova Scotia',        url: 'https://www.cbc.ca/webfeed/rss/rss-canada-novascotia' },
    { name: 'Global News Halifax',    url: 'https://globalnews.ca/halifax/feed' },
    { name: 'The Loadstar',           url: 'https://theloadstar.com/feed/' },
    { name: 'TruckNews',              url: 'https://www.trucknews.com/rss/' },
    { name: 'Transport Topics',       url: 'https://www.ttnews.com/rss.xml' }
  ];

  const FORCE_IMAGE_RESOLVE_HOSTS = ['theloadstar.com', 'www.theloadstar.com'];
  const RSS2JSON_API_KEY = '';

  const MAX_INITIAL = 12;
  const CAP_PER_HOST = 4; // extra guard for client fallback
  const usedImages = new Set();

  let combined = [];
  let rendered = 0;

  statusEl.textContent = 'Loading newsâ€¦';
  window.addEventListener('DOMContentLoaded', init);

  async function init(){
    try {
      const serverItems = await tryServer();
      if (serverItems && serverItems.length) {
        combined = normalizeServerItems(serverItems);
      } else {
        combined = await fetchAllFeedsClient();
      }
    } catch (e) {
      console.warn('Server fetch failed, using client fallback:', e);
      try {
        combined = await fetchAllFeedsClient();
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Could not load news right now.';
        return;
      }
    }

    if (!combined.length){
      statusEl.textContent = 'No news items available.';
      return;
    }

    // newest first + cap per host (client side safety)
    combined.sort((a,b)=> b.date - a.date);
    combined = capPerHost(combined, CAP_PER_HOST);

    statusEl.textContent = '';
    renderMore(MAX_INITIAL);
    startImageHydration();

    if (combined.length > rendered) {
      loadMoreBtn.style.display = 'inline-block';
      loadMoreBtn.addEventListener('click', ()=>{
        renderMore(12);
        startImageHydration();
      });
    }
  }

  // ---------- Server (Netlify function) ----------
  async function tryServer(){
    const r = await fetch('/.netlify/functions/news', { cache: 'no-store' });
    if (!r.ok) throw new Error('news function not available');
    const data = await r.json();
    if (!data || !Array.isArray(data.items) || !data.items.length) throw new Error('no items from server');
    return data.items;
  }

  function normalizeServerItems(items){
    return items.map(a => ({
      source: a.source || 'News',
      title:  a.title  || 'Untitled',
      link:   a.link   || '#',
      date:   new Date(a.date || Date.now()),
      image:  a.image  || '',
      summary:(a.summary || '').trim()
    }));
  }

  // ---------- Client-side RSS fallback ----------
  async function fetchAllFeedsClient(){
    const results = await Promise.allSettled(FEEDS.map(fetchFeedClient));
    const items = [];
    for (const r of results){ if (r.status === 'fulfilled') items.push(...r.value); }
    if (!items.length) throw new Error('No items from client RSS');
    return items;
  }

  async function fetchFeedClient(feed){
    const base = 'https://api.rss2json.com/v1/api.json';
    const params = new URLSearchParams({ rss_url: feed.url, count: '12' });
    if (RSS2JSON_API_KEY) params.set('api_key', RSS2JSON_API_KEY);
    const endpoint = `${base}?${params.toString()}`;
    const res = await fetch(endpoint);
    if (!res.ok) throw new Error(`Fetch failed: ${feed.name}`);
    const data = await res.json();
    if (!data || data.status !== 'ok' || !Array.isArray(data.items)) throw new Error(`Bad feed: ${feed.name}`);
    const srcTitle = (data.feed && data.feed.title) || feed.name;
    return data.items.map(item => mapClientItem(srcTitle, item)).filter(Boolean);
  }

  function mapClientItem(source, item){
    const date = new Date(item.pubDate || item.isoDate || item.published || Date.now());
    const image = extractImage(item) || '';
    const summary = stripHTML(item.description || item.content || '').trim().slice(0, 300);
    const link = item.link || '#';
    const title = item.title || 'Untitled';
    return { source, title, link, date, image, summary };
  }

  function extractImage(item){
    if (item.thumbnail) return harden(item.thumbnail);
    if (item.enclosure) {
      const e = item.enclosure.link || item.enclosure.url;
      const t = (item.enclosure.type || '').toLowerCase();
      if (e && (/\.(png|jpe?g|webp|gif)(\?|$)/i.test(e) || t.startsWith('image/'))) {
        return harden(e);
      }
    }
    const html = item.content || item.content_encoded || item.description || '';
    const m = html && html.match(/<img[^>]+src=["']([^"']+)["']/i);
    return m ? harden(m[1]) : '';
  }

  function harden(u){ if (!u) return ''; return u.startsWith('//') ? 'https:' + u : u; }
  function stripHTML(html){ const d = document.createElement('div'); d.innerHTML = html; return d.textContent || d.innerText || ''; }

  function capPerHost(arr, max){
    const out = [];
    const counter = Object.create(null);
    for (const a of arr) {
      const h = hostFromLink(a.link);
      counter[h] = (counter[h] || 0);
      if (counter[h] < max) { out.push(a); counter[h]++; }
    }
    return out;
  }
  function hostFromLink(u){ try { return new URL(u).hostname.toLowerCase(); } catch(e){ return 'unknown'; } }

  // ---------- Render ----------
  function renderMore(count){
    const slice = combined.slice(rendered, rendered + count);
    const frag = document.createDocumentFragment();
    slice.forEach(a => frag.appendChild(renderCard(a)));
    newsGrid.appendChild(frag);
    rendered += slice.length;
    if (rendered >= combined.length) loadMoreBtn.style.display = 'none';
  }

  function renderCard(a){
    const card = document.createElement('article');
    card.className = 'news-card';
    card.dataset.link  = a.link;

    // avoid reusing the same image URL if we can
    let imgSrc = a.image || '';
    let needsHydration = false;
    if (!imgSrc || usedImages.has(imgSrc)) {
      imgSrc = PLACEHOLDER;
      needsHydration = true;
    } else {
      usedImages.add(imgSrc);
    }

    const dateText = a.date.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    card.innerHTML = `
      <a href="${a.link}" target="_blank" rel="noopener" aria-label="${escapeHTML(a.title)}">
        <img class="news-thumb" src="${imgSrc}" alt="" loading="lazy" ${needsHydration ? 'data-missing="1"' : ''}>
      </a>
      <div class="news-body">
        <div class="news-meta">
          <span class="chip">${escapeHTML(a.source || 'News')}</span>
          <span>${escapeHTML(dateText)}</span>
        </div>
        <h3 class="news-title"><a href="${a.link}" target="_blank" rel="noopener">${escapeHTML(a.title)}</a></h3>
        ${a.summary ? `<p class="muted">${escapeHTML(a.summary)}</p>` : ''}
        <div class="news-actions"><a class="link" href="${a.link}" target="_blank" rel="noopener">Read more â†’</a></div>
      </div>
    `;
    const img = card.querySelector('img');
    img.onerror = () => { img.src = PLACEHOLDER; img.onerror = null; };
    return card;
  }

  function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // ---------- Smart image hydration ----------
  function startImageHydration(){
    const cards = Array.from(newsGrid.querySelectorAll('.news-card'));
    const jobs = cards
      .filter(card => {
        const img = card.querySelector('img');
        return !img || img.getAttribute('data-missing') === '1' || FORCE_IMAGE_RESOLVE_HOSTS.includes(hostFromLink(card.dataset.link));
      })
      .map(card => () => hydrateCardImage(card));

    runQueue(jobs, 2);
  }

  async function hydrateCardImage(card){
    const url = card.dataset.link;
    if (!url) return;
    try {
      const res = await fetch('/.netlify/functions/news-image?u=' + encodeURIComponent(url), { cache: 'no-store' });
      if (!res.ok) return;
      const data = await res.json();
      const newImg = (data && data.image) ? data.image : '';
      if (newImg && !usedImages.has(newImg)) {
        const img = card.querySelector('img');
        img.src = newImg;
        img.removeAttribute('data-missing');
        usedImages.add(newImg);
      }
    } catch(e){ /* ignore */ }
  }

  function runQueue(tasks, concurrency){
    let idx = 0, active = 0;
    const next = () => {
      if (idx >= tasks.length && active === 0) return;
      while (active < concurrency && idx < tasks.length) {
        const fn = tasks[idx++]; active++;
        Promise.resolve().then(fn).finally(()=>{ active--; next(); });
      }
    };
    next();
  }
})();
</script>

<script src="/assets/js/site.js?v=20250815" defer></script>
</body>
</html>

