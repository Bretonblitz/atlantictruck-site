<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Industry News | Atlantic Truck & Equipment Repair</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Latest Atlantic Canada & North American trucking news, products, and features." />
  <style>
    :root { --max: 1100px; --pad: 16px; --radius: 14px; --gap: 18px; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; color:#0b1020; background:#f6f7fb;}
    header{background:#0b2a4a; color:#fff; padding:28px var(--pad);}
    header h1{margin:0; font-size: clamp(22px, 3vw, 34px);}
    main{max-width:var(--max); margin:24px auto; padding:0 var(--pad);}
    .feeds-note{font-size:14px; color:#4a5568; margin:4px 0 22px}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:var(--gap);}
    .card{background:#fff; border-radius:var(--radius); box-shadow:0 6px 16px rgba(0,0,0,.06); overflow:hidden; display:flex; flex-direction:column}
    .thumb{width:100%; aspect-ratio:16/9; object-fit:cover; background:#e8ecf3}
    .card-content{padding:16px}
    .src{font-size:12px; text-transform:uppercase; letter-spacing:.06em; color:#52607a; margin-bottom:6px}
    .title{margin:0 0 8px; font-size:18px; line-height:1.25}
    .meta{font-size:12px; color:#6b7280; margin:0 0 10px}
    .excerpt p{margin:0 0 10px}
    .actions{margin-top:auto; padding:0 16px 16px}
    .btn{display:inline-block; text-decoration:none; border:1px solid #0b2a4a; padding:10px 14px; border-radius:10px}
    .btn:hover{background:#0b2a4a; color:#fff}
    .error, .loading{background:#fff3f3; border:1px solid #ffc7c7; color:#7a1111; padding:12px 14px; border-radius:12px; margin:12px 0}
    .loading{background:#eef6ff; border-color:#cfe5ff; color:#0b2a4a}
  </style>
</head>
<body>
  <header>
    <h1>Trucking News</h1>
    <p style="opacity:.85; margin-top:6px;">Fresh headlines from trusted trucking outlets. Updated automatically.</p>
  </header>

  <main>
    <div class="feeds-note">Sources: TruckNews (CA), Transport Topics (US). Add/remove feeds inside the script.</div>
    <div id="status" class="loading">Loading the latest…</div>
    <section id="news" class="grid" aria-live="polite"></section>
  </main>

  <script>
  // -------- CONFIG: add any public RSS feed URLs here --------
  const FEEDS = [
    { name: "TruckNews", url: "https://www.trucknews.com/rss/" },          // :contentReference[oaicite:1]{index=1}
    { name: "Transport Topics", url: "https://www.ttnews.com/rss.xml" }    // industry-standard
  ];

  // Fallback image
  const PLACEHOLDER_IMG = "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(
    `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='675'>
      <rect width='100%' height='100%' fill='#e8ecf3'/>
      <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#52607a' font-family='Arial' font-size='26'>Trucking News</text>
    </svg>`
  );

  const newsEl = document.getElementById("news");
  const statusEl = document.getElementById("status");

  // Uses api.rss2json.com (no key) — simple for static sites.
  // If you ever hit rate limits, switch to your own RSS widget or a small serverless proxy.
  async function fetchFeed(feed) {
    const endpoint = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`;
    const res = await fetch(endpoint);
    if (!res.ok) throw new Error(`Fetch failed for ${feed.name}`);
    const data = await res.json();
    if (!data || !data.items) throw new Error(`No items for ${feed.name}`);
    return data.items.map(item => ({
      source: feed.name,
      title: item.title,
      url: item.link,
      date: new Date(item.pubDate || item.pub_date || Date.now()),
      // Try image fields, then content sniff
      image: item.thumbnail || (item.enclosure && item.enclosure.link) || extractImage(item.content || item.content_html) || PLACEHOLDER_IMG,
      excerpt: stripHtml(item.description || item.content || "").trim()
    }));
  }

  function stripHtml(html) {
    const div = document.createElement("div");
    div.innerHTML = html;
    return div.textContent || div.innerText || "";
  }

  function extractImage(html) {
    if (!html) return null;
    const div = document.createElement("div");
    div.innerHTML = html;
    const img = div.querySelector("img");
    return img ? img.src : null;
  }

  function formatDate(d) {
    return d.toLocaleString(undefined, { year: "numeric", month: "short", day: "numeric" });
    // If you want time too: add hour/minute options
  }

  function buildCard(a) {
    const article = document.createElement("article");
    article.className = "card";
    article.innerHTML = `
      <img class="thumb" loading="lazy" alt="" src="${a.image}">
      <div class="card-content">
        <div class="src">${a.source}</div>
        <h3 class="title">${a.title}</h3>
        <p class="meta">${formatDate(a.date)}</p>
        <div class="excerpt"></div>
      </div>
      <div class="actions">
        <a class="btn" href="${a.url}" target="_blank" rel="noopener">Read full article</a>
      </div>
    `;
    // Make sure there are at least two short paragraphs
    const ex = a.excerpt.length > 400 ? a.excerpt.slice(0, 400) + "…" : a.excerpt;
    const p1 = document.createElement("p");
    p1.textContent = ex.slice(0, Math.ceil(ex.length / 2)).trim();
    const p2 = document.createElement("p");
    p2.textContent = ex.slice(Math.ceil(ex.length / 2)).trim() || "—";
    article.querySelector(".excerpt").append(p1, p2);
    return article;
  }

  (async function init() {
    try {
      const all = (await Promise.allSettled(FEEDS.map(fetchFeed)))
        .flatMap(r => r.status === "fulfilled" ? r.value : []);
      if (!all.length) throw new Error("No news items loaded.");
      // sort newest first, cap to 18
      all.sort((a,b) => b.date - a.date);
      const items = all.slice(0, 18);
      items.forEach(item => newsEl.appendChild(buildCard(item)));
      statusEl.remove();
    } catch (err) {
      statusEl.className = "error";
      statusEl.textContent = "Couldn’t load the news feed right now. Please refresh in a minute.";
      console.error(err);
    }
  })();
  </script>
</body>
</html>
