<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>News | Atlantic Truck & Equipment Repair</title>
  <meta name="description" content="News | Atlantic Truck & Equipment Repair">
  <meta property="og:title" content="News | Atlantic Truck & Equipment Repair">
  <meta property="og:description" content="News | Atlantic Truck & Equipment Repair">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_CA">
  <meta name="theme-color" content="#B9111B">
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="apple-touch-icon" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="stylesheet" href="/assets/css/style.css">
  <style>
    .news-list { display:flex; flex-direction:column; gap:18px; }
    .news-item { border:1px solid #eee; border-radius:12px; padding:14px; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,.06); }
    .news-head { display:flex; align-items:baseline; gap:10px; margin-bottom:8px; }
    .news-date { font-size:.9rem; color:#6b7280; }
    .news-text { line-height:1.5; margin-top:8px; }
    .divider { height:1px; background:#eee; margin-top:12px; }

    /* Gallery (half-width image, native aspect) */
    .news-gallery { display:flex; align-items:center; gap:8px; margin:8px 0; }
    .news-gallery .navbtn { border:1px solid #ddd; background:#fafafa; border-radius:10px; padding:6px 10px; cursor:pointer; user-select:none; }
    .news-gallery .navbtn:disabled { opacity:.4; cursor:default; }
    .news-gallery .frame { flex:1; display:flex; justify-content:center; }
    /* CSS fallback; we‚Äôll also set inline width to avoid ‚Äúflash‚Äù before CSS applies */
    .news-gallery img { width:50%; height:auto; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.08); cursor:zoom-in; }
    @media (max-width: 700px){ .news-gallery img { width:100%; } }

    .news-actions { margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .btn-light.btn-read { border:1px solid #ddd; border-radius:10px; padding:8px 12px; background:#fff; }

    /* Lightbox */
    .lightbox { position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:9999; }
    .lightbox.open { display:flex; }
    .lightbox img { max-width:95vw; max-height:90vh; border-radius:10px; box-shadow:0 10px 40px rgba(0,0,0,.5); }
    .lightbox .lb-btn { position:absolute; background:rgba(255,255,255,.9); border:none; border-radius:10px; padding:8px 12px; cursor:pointer; }
    .lightbox .lb-close { top:20px; right:20px; font-weight:700; }
    .lightbox .lb-prev { left:20px; }
    .lightbox .lb-next { right:20px; }
  </style>

  <!-- Tell global site.js to skip its old news renderer -->
  <script>window.__DISABLE_GLOBAL_NEWS = true;</script>
</head>
<body>
<!-- Emergency bar -->
<div class="emergency-bar">
  <div class="container row spread center">
    <strong>24/7 Emergency Recovery &amp; Towing</strong>
    <div class="row wrap">
      <a class="link-invert" href="tel:9025651730">After Hours: 902-565-1730</a>
      <span class="sm-hide">|</span>
      <a class="link-invert" href="tel:9025657211">902-565-7211</a>
      <a class="btn-light sm-hide" href="/requests.html">Requests</a>
    </div>
  </div>
</div>

<!-- Header -->
<header class="site-header">
  <div class="container row spread center">
    <a class="brand row center" href="/index.html">
      <img class="logo" alt="Atlantic Truck & Equipment Repair logo" src="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
      <div>
        <div class="brand-title">Atlantic Truck &amp; Equipment Repair</div>
        <div class="brand-tag">Largest heavy equipment tow trucks east of Halifax</div>
      </div>
    </a>
    <nav class="main-nav">
      <button class="nav-toggle" aria-label="Toggle menu" onclick="document.getElementById('navList').classList.toggle('open')">‚ò∞</button>
      <ul class="nav-list" id="navList">
        <li><a href="/index.html">Home</a></li>
        <li class="has-sub"><a href="/services/index.html">Services</a>
          <ul class="sub">
            <li><a href="/services/emergency-towing.html">Emergency Towing</a></li>
            <li><a href="/services/towing.html">Towing</a></li>
            <li><a href="/services/repair.html">Repair</a></li>
            <li><a href="/services/inspection.html">Inspection</a></li>
            <li><a href="/services/authorized-parts.html">Authorized Parts</a></li>
            <li><a href="/services/welding.html">Welding</a></li>
          </ul>
        </li>
        <li><a href="/gallery.html">Gallery</a></li>
        <li><a class="active" href="/news.html">News</a></li>
        <li><a href="/service-area.html">Service Area</a></li>
        <li><a href="/requests.html">Requests</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
    <div class="header-cta sm-hide">
      <a id="smartCta" class="btn" href="tel:9025394574" aria-label="Call 24/7 Dispatch">Call 24/7 Dispatch</a>
    </div>
  </div>
</header>

<section class="section">
  <div class="container">
    <h1>News</h1>
    <div id="newsFeed" class="news-list" aria-live="polite"></div>
    <div style="margin-top:14px">
      <a class="btn-light" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=61579126693357">See more on Facebook</a>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="container grid-4">
    <div>
      <div class="footer-title">Atlantic Truck &amp; Equipment Repair Ltd.</div>
      <p class="muted">Trusted for towing, repairs, inspections &amp; welding across Cape Breton and most of Nova Scotia.</p>
      <div class="row wrap" style="gap:12px;margin-top:10px">
        <img src="/assets/img/freightliner.png" alt="Freightliner logo" style="height:26px">
        <img src="/assets/img/western-star.png" alt="Western Star logo" style="height:26px">
      </div>
      <div style="margin-top:10px"><a href="https://www.facebook.com/profile.php?id=61579126693357" target="_blank" rel="noopener">üìò Follow us on Facebook</a></div>
    </div>
    <div>
      <div class="footer-title">Services</div>
      <ul class="plain">
        <li><a href="/services/emergency-towing.html">Emergency Towing</a></li>
        <li><a href="/services/towing.html">Towing</a></li>
        <li><a href="/services/repair.html">Repairs</a></li>
        <li><a href="/services/inspection.html">Inspections</a></li>
        <li><a href="/services/authorized-parts.html">Authorized Parts</a></li>
        <li><a href="/services/welding.html">Welding</a></li>
      </ul>
    </div>
    <div>
      <div class="footer-title">Contact</div>
      <ul class="plain">
        <li>Main: <a href="tel:902-539-4574">902-539-4574</a></li>
        <li>Service: <a href="mailto:service@atlantictruck.ca">service@atlantictruck.ca</a></li>
        <li>Parts: <a href="mailto:parts@atlantictruck.ca">parts@atlantictruck.ca</a></li>
        <li>Office: <a href="mailto:office@atlantictruck.ca">office@atlantictruck.ca</a></li>
        <li>After Hours: <a href="tel:902-565-1730">902-565-1730</a> / <a href="tel:902-565-7211">902-565-7211</a></li>
        <li>Hours: Mon‚ÄìFri 8:00 AM ‚Äì 4:30 PM</li>
      </ul>
    </div>
    <div>
      <div class="footer-title">Find Us</div>
      <address class="muted small">
        417 Gulf Crescent, Edwardsville, NS B2A 4T9
      </address>
      <a class="btn-light" target="_blank" href="https://maps.google.com/?q=417%20Gulf%20Crescent,%20Edwardsville,%20NS%20B2A%204T9">Directions</a>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="container row spread small">
      <span>¬© 2025 Atlantic Truck &amp; Equipment Repair Ltd.</span>
      <span>Edwardsville, Nova Scotia</span>
    </div>
  </div>
</footer>

<div class="action-bar md-hide">
  <a href="tel:9025394574">Call</a>
  <a target="_blank" href="https://maps.google.com/?q=417%20Gulf%20Crescent,%20Edwardsville,%20NS%20B2A%204T9">Directions</a>
  <a href="/requests.html">Requests</a>
</div>

<!-- Load global (for smart CTA only) -->
<script src="/assets/js/site.js?v=20250815" defer></script>

<!-- Self-contained news renderer -->
<script>
(function(){
  const FEED = document.getElementById('newsFeed');

  function fmtDateHalifax(iso){
    try {
      return new Intl.DateTimeFormat('en-CA',{ timeZone:'America/Halifax', year:'numeric', month:'short', day:'2-digit' }).format(new Date(iso));
    } catch { return ''; }
  }
  async function fetchJSON(path){
    try{
      const r = await fetch(path, { headers:{'Accept':'application/json'} });
      if(!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    }catch(e){ console.error(e); return {data:[]}; }
  }
  function truncateWords(s, max){
    const words=(s||'').trim().split(/\s+/);
    if(words.length<=max) return { short:s||'', truncated:false };
    return { short: words.slice(0,max).join(' ')+'‚Ä¶', truncated:true };
  }
  function extractImages(p){
    if (Array.isArray(p.images) && p.images.length) return dedupe(p.images);
    return p.full_picture ? [p.full_picture] : [];
  }
  function dedupe(arr){
    const seen=new Set(), out=[];
    for(const u of arr){
      const key=(String(u).split('?')[0]||'').toLowerCase();
      if(!seen.has(key)){ seen.add(key); out.push(u); }
    }
    return out;
  }

  let LB=null, lbImg=null, lbPrev=null, lbNext=null, lbClose=null, lbImages=[], lbIdx=0;
  function ensureLightbox(){
    if(LB) return;
    LB=document.createElement('div');
    LB.className='lightbox';
    LB.innerHTML=`
      <button class="lb-btn lb-close" aria-label="Close">‚úï</button>
      <button class="lb-btn lb-prev" aria-label="Previous">‚Äπ</button>
      <img alt="Expanded image">
      <button class="lb-btn lb-next" aria-label="Next">‚Ä∫</button>
    `;
    document.body.appendChild(LB);
    lbImg=LB.querySelector('img');
    lbPrev=LB.querySelector('.lb-prev');
    lbNext=LB.querySelector('.lb-next');
    lbClose=LB.querySelector('.lb-close');
    lbPrev.addEventListener('click', ()=> nav(-1));
    lbNext.addEventListener('click', ()=> nav(1));
    lbClose.addEventListener('click', ()=> LB.classList.remove('open'));
    LB.addEventListener('click', (e)=>{ if(e.target===LB) LB.classList.remove('open'); });
    document.addEventListener('keydown', (e)=>{
      if(!LB.classList.contains('open')) return;
      if(e.key==='Escape') LB.classList.remove('open');
      if(e.key==='ArrowLeft') nav(-1);
      if(e.key==='ArrowRight') nav(1);
    });
  }
  function openLightbox(images,start){
    ensureLightbox();
    lbImages=images; lbIdx=start||0;
    lbImg.src=lbImages[lbIdx];
    LB.classList.add('open');
  }
  function nav(delta){
    if(!lbImages.length) return;
    lbIdx=(lbIdx+lbImages.length+delta)%lbImages.length;
    lbImg.src=lbImages[lbIdx];
  }

  async function load(){
    FEED.innerHTML='<div class="news-item"><div class="news-text muted">Loading‚Ä¶</div></div>';

    const json = await fetchJSON('/.netlify/functions/get-facebook-posts?limit=10');
    const posts = Array.isArray(json.data) ? json.data : [];
    if(!posts.length){
      FEED.innerHTML='<div class="news-item"><div class="news-text muted">No updates yet.</div></div>';
      return;
    }

    FEED.innerHTML='';
    posts.forEach((p, idx)=>{
      const date = fmtDateHalifax(p.created_time);
      const images = extractImages(p);
      const message = (p.message||'').trim();
      const { short, truncated } = truncateWords(message, 50);

      const item=document.createElement('article');
      item.className='news-item';

      const gallery = images.length ? `
        <div class="news-gallery" data-cur="0">
          <button class="navbtn prev" type="button" aria-label="Previous image" ${images.length<=1?'disabled':''}>‚Äπ</button>
          <div class="frame">
            <!-- inline style prevents the ‚Äúfull then half‚Äù flash before CSS loads -->
            <img src="${images[0]}" alt="Post image ${idx+1}" loading="lazy"
                 style="width:50%;height:auto;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.08);cursor:zoom-in;">
          </div>
          <button class="navbtn next" type="button" aria-label="Next image" ${images.length<=1?'disabled':''}>‚Ä∫</button>
        </div>
      ` : '';

      item.innerHTML = `
        <div class="news-head">
          <h2 class="h4" style="margin:0">Update</h2>
          <div class="news-date">${date}</div>
        </div>
        ${gallery}
        <div class="news-text">
          <span class="short">${short.replace(/\n/g,'<br>')}</span>
          ${truncated ? `<span class="full" style="display:none">${message.replace(/\n/g,'<br>')}</span>` : ''}
        </div>
        <div class="news-actions">
          ${truncated ? `<button class="btn-light btn-read" type="button">Read more</button>` : ''}
        </div>
        <div class="divider"></div>
      `;

      // read more toggle
      if(truncated){
        const btn=item.querySelector('.btn-read');
        const shortEl=item.querySelector('.short');
        const fullEl=item.querySelector('.full');
        btn.addEventListener('click', ()=>{
          const expand = fullEl.style.display==='none';
          fullEl.style.display = expand ? 'inline' : 'none';
          shortEl.style.display = expand ? 'none'  : 'inline';
          btn.textContent = expand ? 'Show less' : 'Read more';
        });
      }

      // slideshow + lightbox
      if(images.length){
        const g=item.querySelector('.news-gallery');
        const img=g.querySelector('img');
        const prev=g.querySelector('.prev');
        const next=g.querySelector('.next');
        let cur=0;
        function update(){
          img.src=images[cur];
          prev.disabled=(cur===0);
          next.disabled=(cur===images.length-1);
        }
        prev.addEventListener('click', ()=>{ if(cur>0){ cur--; update(); }});
        next.addEventListener('click', ()=>{ if(cur<images.length-1){ cur++; update(); }});
        img.addEventListener('click', ()=> openLightbox(images, cur));
      }

      FEED.appendChild(item);
    });
  }

  document.addEventListener('DOMContentLoaded', load);
})();
</script>
</body>
</html>
