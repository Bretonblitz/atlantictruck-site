<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Traffic Advisories | Atlantic Truck & Equipment Repair</title>
  <meta name="description" content="Nova Scotia road closures and traffic advisories gathered in one place.">
  <meta property="og:title" content="Traffic Advisories | Atlantic Truck & Equipment Repair">
  <meta property="og:description" content="Nova Scotia road closures and traffic advisories gathered in one place.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_CA">
  <meta name="theme-color" content="#B9111B">
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="apple-touch-icon" href="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
  <link rel="stylesheet" href="/assets/css/style.css">
  <style>
    .news-grid { display:grid; gap:16px; grid-template-columns: repeat(3,minmax(0,1fr)); }
    @media (max-width: 980px){ .news-grid{grid-template-columns: repeat(2,minmax(0,1fr));} }
    @media (max-width: 640px){ .news-grid{grid-template-columns: 1fr;} }
    .news-card { background:#fff; border-radius:10px; box-shadow: 0 1px 3px rgba(0,0,0,.08); overflow:hidden; display:flex; flex-direction:column; }
    .news-thumb { width:100%; aspect-ratio: 16/9; object-fit:cover; display:block; background:#f3f3f3; }
    .news-body { padding:14px; display:flex; flex-direction:column; gap:8px; }
    .news-meta { font-size:12px; color:#666; display:flex; gap:8px; flex-wrap:wrap; }
    .chip { background:#fff2cc; color:#8a6d00; border:1px solid #ffe58f; border-radius:999px; padding:3px 8px; font-size:12px; }
  </style>
</head>
<body>
<div class="emergency-bar">
  <div class="container row spread center">
    <strong>24/7 Emergency Recovery &amp; Towing</strong>
    <div class="row wrap">
      <a class="link-invert" href="tel:9025651730">After Hours: 902-565-1730</a>
      <span class="sm-hide">|</span>
      <a class="link-invert" href="tel:9025657211">902-565-7211</a>
      <a class="btn-light sm-hide" href="/requests.html#service">Requests</a>
    </div>
  </div>
</div>

<header class="site-header">
  <div class="container row spread center">
    <a class="brand row center" href="/index.html">
      <img class="logo" alt="Atlantic Truck & Equipment Repair logo" src="https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png">
      <div>
        <div class="brand-title">Atlantic Truck &amp; Equipment Repair</div>
        <div class="brand-tag">Largest heavy equipment tow trucks east of Halifax</div>
      </div>
    </a>
    <nav class="main-nav">
      <button class="nav-toggle" aria-label="Toggle menu" onclick="document.getElementById('navList').classList.toggle('open')">☰</button>
      <ul class="nav-list" id="navList">
        <li><a href="/index.html">Home</a></li>
        <li class="has-sub"><a href="/services/index.html">Services</a>
          <ul class="sub">
            <li><a href="/services/emergency-towing.html">Emergency Towing</a></li>
            <li><a href="/services/towing.html">Towing</a></li>
            <li><a href="/services/repair.html">Repair</a></li>
            <li><a href="/services/inspection.html">Inspection</a></li>
            <li><a href="/services/authorized-parts.html">Authorized Parts</a></li>
            <li><a href="/services/welding.html">Welding</a></li>
          </ul>
        </li>
        <li><a href="/gallery.html">Gallery</a></li>
        <li><a href="/news.html">News</a></li>
        <li><a class="active" href="/traffic.html">Traffic</a></li>
        <li><a href="/service-area.html">Service Area</a></li>
        <li><a href="/requests.html">Requests</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
    <div class="header-cta sm-hide">
      <a id="smartCta" class="btn" href="tel:9025394574" aria-label="Call 24/7 Dispatch">Call 24/7 Dispatch</a>
    </div>
  </div>
</header>

<section class="section">
  <div class="container">
    <h1>Traffic Advisories</h1>
    <p class="muted">Road closures, lane reductions, and detours from official Nova Scotia traffic sources.</p>
    <p><a href="/news.html">← Back to News</a></p>

    <div id="grid" class="news-grid" aria-live="polite"></div>
    <div id="status" class="muted" style="margin-top:12px"></div>
  </div>
</section>

<footer class="site-footer">
  <div class="container row spread small">
    <span>© 2025 Atlantic Truck &amp; Equipment Repair Ltd.</span>
    <span>Edwardsville, Nova Scotia</span>
  </div>
</footer>

<script>
(function(){
  const grid = document.getElementById('grid');
  const status = document.getElementById('status');
  const PLACEHOLDER =
    'https://static.wixstatic.com/media/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png/v1/fill/w_522,h_210,al_c,lg_1,q_85,enc_avif,quality_auto/ba2cd3_4e99b20ca6934c6d9fbfdec7aafd3952~mv2.png';
  const usedImages = new Set();

  status.textContent = 'Loading advisories…';
  window.addEventListener('DOMContentLoaded', init);

  async function init(){
    try {
      const r = await fetch('/.netlify/functions/traffic', { cache: 'no-store' });
      if (!r.ok) throw new Error('traffic function not available');
      const data = await r.json();
      if (!data || !Array.isArray(data.items) || !data.items.length) throw new Error('no items');
      render(data.items);
      status.textContent = '';
    } catch(e){
      status.textContent = 'Could not load traffic advisories right now.';
    }
  }

  function render(items){
    const frag = document.createDocumentFragment();
    items.forEach(a => frag.appendChild(card(a)));
    grid.appendChild(frag);
  }

  function card(a){
    const dateText = new Date(a.date || Date.now()).toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });

    let imgSrc = a.image || '';
    if (!imgSrc || usedImages.has(imgSrc)) imgSrc = PLACEHOLDER; else usedImages.add(imgSrc);

    const el = document.createElement('article');
    el.className = 'news-card';
    el.innerHTML = `
      <a href="${a.link}" target="_blank" rel="noopener">
        <img class="news-thumb" src="${imgSrc}" alt="">
      </a>
      <div class="news-body">
        <div class="news-meta">
          <span class="chip">Traffic advisory</span>
          <span>${dateText}</span>
        </div>
        <h3 class="news-title"><a href="${a.link}" target="_blank" rel="noopener">${escapeHTML(a.title || 'Advisory')}</a></h3>
        ${a.summary ? `<p class="muted">${escapeHTML(a.summary)}</p>` : ''}
        <div class="news-actions"><a class="link" href="${a.link}" target="_blank" rel="noopener">Open →</a></div>
      </div>
    `;
    const img = el.querySelector('img');
    img.onerror = () => { img.src = PLACEHOLDER; img.onerror = null; };
    return el;
  }

  function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
})();
</script>
<script src="/assets/js/site.js?v=20250815" defer></script>
</body>
</html>
